#include <U8g2lib.h>
#include <U8x8lib.h>

#include <SD.h>

#include <Arduino.h>
#ifdef U8X8_HAVE_HW_I2C
#include <Wire.h>
#endif

int F1_offset, F2_offset, EN_offset;       // current offset for the scrolling text
int F1_width, F2_width, EN_width;          //Width of the values
const int F1_y = 12, F2_y = 30, EN_y = 55; //Y value to print on
char buffer_char[100];
char F1[100], F2[100], EN[100];               //Actual values
int x;
File printFile;

U8G2_SSD1306_128X64_NONAME_1_SW_I2C u8g2(U8G2_R0, /* clock=*/ PIN_WIRE_SCL, /*data=*/ PIN_WIRE_SDA, /*reset=*/ U8X8_PIN_NONE); // All Boards without Reset of the Display

const uint8_t u8g2_font_f12_kana[4147] U8G2_FONT_SECTION("u8g2_font_f12_kana") =
  "\340\0\4\2\4\4\4\5\5\14\14\0\376\0\0\0\0\0\0\0\0\0\2\0\0\60\0\6\0\250\71\60"
  "\1\11\62\351\70D\22\1\60\2\13\64\351x(\42\11\5\0\60\3\14f\32\271\364E\244E$\2\60"
  "\5\22\230\371\370\344\6\232\222L$\224\210$b\302\2\60\6\20\231\11\71\326\25)B\21M\244EL"
  "\7\60\7\25\273\350\70\315\64\232\134$\227HZ&r\221\134\306l\4\60\10\21\304\356\370D\62\221L"
  "$\23\312\204\62\241\0\60\11\22\304\352\70\204\62\241L(\23\311D\62\221\14\0\60\12\27\307\353\370D"
  "\332D\332D\332DB\221L$\24\311DB\221\0\60\13\30\307\352\70DB\221L$\24\311DB\221"
  "L\244M\244M\244\15\0\60\14\12\204.\71\14\64}\3\60\15\11\204\352\370\364\315@\60\16\22\205-"
  "\71\334(\6\211H\42\222\210$\42\23\0\60\17\22\205\352\270L\22\221D$\21I\14\22\232\301\0\60"
  "\20\16\304\356\70\34$\26\22\237,\16\2\60\21\15\304\352\70\14\22'~q\60\10\60\22\21\274\350x"
  "\14\16\42\203\203\364\340_I}\5\60\23\13l\30\71\374\367\310\301?\60\24\14\304\356\270\14\42\231~"
  "#\22\60\25\14\304\352\70\210\64\375\311 \2\60\26\23\305\356\70\234$J\22\21\215\233D$\21\251\30"
  "\10\60\27\23\305\352\70\14\24\221\212H\42\343I\42\222(\31\14\60\30\27\305\356\370\14$\221E$\21"
  "ID\22\221D$\21\211\14T\2\60\31\27\305\352\70\250\6\222\212H\42\222\210$\42\211Hb\22\31"
  "h\0\60\34\14J)y\314\62\321Ll\1\60\35\14F]\371($\65\221\14\0\60\36\14\66my"
  "XD\22\221\10\0\60\37\14F\351\370D\62\221\210B\3\60 \36\273\351x\14\256\7'\231\212\204\42"
  "\241\230\134(\22\212\66\211Hd\222I\245\6\32\0\60!\11\262\355\70\374\201\42\60\42\13\264\354\370H"
  "\374I\246\0\60#\35\270\352\270\15B\203Hb\220P\14\22\212AB\61H(\6\11\305 \222\220\351"
  "\2\60$\23\251\371\70\344V\12\215\205j\266Rh,T\273\0\60%\26\226\374x(\6\11\305 \63"
  "QD\42\212\210\42\242\30D\0\60&\16j)\71%\205&\211\301Abp\60'\22z\31\71\11E"
  "\203\213\301Ax\260\31\14\24\0\60(\23\253\370\70)-B\203\201\36;\330\3\23\203\3\1\60)\24"
  "\251\372\370\344r\203Ab\60\220\204Jb:Y\304h\60\63\13j\12y\350\42Ri\3\60\64\16\232"
  "\12\71\351\262\42E*\42\225\66\60\65\14j\10\371\315r\62]\60\11\60A\22w\372\270\244\6\241D"
  "f \231(\62\211L\2\60B\31\271\371\370\4c\203Up\20\212$\42\222\210\242F\242\221d\42&"
  "\0\60C\16V\12y\244\42\211\220\42\222\10\1\60D\23\211\11y\4C\221X\42\226\310IB\211\242"
  "H\14\60E\16u\372x\244$\213L(\23\221\0\60F\20\267\372\270\344\264\23M.V\25\322\210\0"
  "\60G\16w\371\270\344B\3UH\24\251\31\60H\21\271\371\370$\345\3a\256N\26\11e\252\6\60"
  "I\20w\372\270\204\6\211L\311F\222(i\2\60J\33\272\371\370$\223\223\304 \225Ie\6)M"
  "E(\21\11%\42\231\214D\3\60K\31\252\371\270$C\221\201\246\244&\222\211\324$\62\251L(\21"
  "\311\251\0\60L\33\252\371\270\204\22\221Pb\260)\251\211d\42\65\211L*\23JDr*\0\60M"
  "\23\267\372\370\304\26\203\334`\240\313,jv\271A\2\60N\26\270\372\370$j\26\3\341b \14-"
  "\42\31E\60\70\210\0\60O\13\244\373\370\224\264\11\265\11\60P\17\247\372\370\304\24\221D\253X\256Y"
  "\6\60Q\31\272\371\370eR\231\324\42\62\210\304\42\261H,\222\10eR\301\234\10\60R\31\273\371\270"
  "%\32%ZM\42\203L,\23\313\304\62\211PU\62\250\2\60S\17\230\12y\4\7z\232\134,\61"
  "X\0\60T\22\231\11y\204\22\221\201\42O\26\214E\6\23\0\60U\24\270\372\370\344\202\211\301@\26"
  "\314\14\22E\212\240p\2\60V\31\271\371\370D\22\231H\42\224P\14v\311\320 \21\11I\222\312\15"
  "\0\60W\15\247\373\70\304\372U\42\242\321\0\60X\21\247\373\70\304\62\11MB\326U\42\242\321\0\60"
  "Y\23\271\371x\5\63\203\253\330*\222\212\304\206\271\230\12\60Z\26\272\371x%\252\22\211\301A,\67"
  "\213\304\42\271e\60'\3\60[\26\252\371\270\245\62\251\314\340@\225IeR\221X\64:\210\0\60\134"
  "\31\253\370\270%J\62\211\222\314d\60\210eb\231X$\227\315\16\62\0\60]\17\251\371\270\14tM"
  "\6w\205\311\244\4\60^\24\252\371\270\14\26\251DQ\60\262\30\14+\243Q\15\0\60_\25\271\371\370"
  "\4S\203U\60$\211h\202%\241L(\64\10\60`\31\272\371\370$\63\211\301 Q\222\14i\42\242"
  "dI*\223\12\15\22\0\60a\24\270\371\270\344R\203A&\27\213h&U\271\224f\3\60b\27\271"
  "\371\270\4\63\211\301@\21\11\346\42\242I&\25\214\211F\0\60c\14V\372\270,\64\251PF\2\60"
  "d\20z\30\71\15\42\203P\64\31\314\311D\0\60e\22\213\30\71&\62\203Db\20\312F\223A\235"
  "\14\60f\16\231\11\271\15\16s\205\225\311\5\0\60g\22\232\10\271-\6\313DQ$\221I\226F'"
  "\0\60h\20\250\372\270\344\12#\232\221*\26\14\16\6\60i\25\251\372\270d\22\221L\42\222\214\210V"
  "\262\134\62\71X\0\60j\33\272\371\370$s\3I&\224\210\204\62\251L*\222\31\244\62\242L\42\264"
  "\1\60k\24\251\371x\4C\222\210&\330&\224\11%\42\203D\16\60l\32\252\371x\325\244\22\3\215"
  "\244M\205\42\244(\222D\24\222D$\242Y\0\60m\32\272\371\270$\353\6\211Q\42\223\21eR\21"
  "UD\263(\211H\62\22\0\60n\31\232\11\371\14R\211H&\222IdB\232\220$%\11ED\71"
  "\15\0\60o\33\252\371x\244\62\251Eb \211Eb\221X$\63\210\324(\22\232D\311\6\60p\36"
  "\273\371\70&\252\24U\241\304`\22\313\304\62\261Lf\220\211d$\11M\42\22\31\1\60q\37\273\371"
  "\70JR\221Dj\222\30hb\231X&\226\311\14\62\221\214$\241ID\42#\0\60r\24\251\372\70"
  "\245v\231\242LH\221J\250\42\251L\325\10\60s\32\253\371\70e\22\211Q\42\222I\205R!M*"
  "\21I\205R\65\271\31\0\60t\31\273\371\70\212\62\221AJS\25J\205\64\251D$\25J\325\344f"
  "\0\60u\26\252\371\370D\367\220d$\24\251\211d\22\241\210\42\23\33\1\60v\30\252\371\370T\204\6"
  "\211x\62\22\212\324D\62\211PD\221\211\215\0\60w\31\253\371\370\204T\203HP\25\215\244\42E\221"
  "L$\24I\324\344V\0\60x\14j\31\371\350\42!Q\264\1\60y\17\212\31\371%r\211\214.\22"
  "\22E\33\60z\21\213\30\71\12#!\211(\22\13ed\331\2\60{\35\252\371x$\6\203D*\223"
  "\212d\6\212X$\26\311\14\42\65\212\204&Q\262\1\60|\37\273\371\70&*\6\213\252P*\223\31"
  "Hb\231X&\63\310D\62\222\204&\21\211\214\0\60} \273\371\70J\22\3I\42\65Ie\62\3"
  "I,\23\313d\6\231HF\222\320$\42\221\21\0\60~\27\270\372\70\345\62\203\201(\267\30\350B\203"
  "Lf\221\211$F\0\60\31\252\371x\14\222%\261Hh\260Id\24\221LB\21\312\204\202!\0"
  "\60\200\31\272\371\370$c\3\211(\225\230Eb\221X\42\25QeR\241\201\4\60\201\26\252\371x\225"
  "\214\22m$\35)\212$)I(\42\312i\0\60\202\26\270\371\370\344R\3U,\223\30\214r\241H"
  "(\23II\0\60\203\22x\372\270$R\211\203DI(\223\20\345B\0\60\204\27\273\370x\345\42\271"
  "\314*!\311,\62\213T\211,\232\215\246\0\60\205\20w\373\370\224,\22\222ED\62J\205\0\60\206"
  "\32\272\371x%C\231A\244\42\222(\311l\62\213\222Df\20\11\5\313\0\60\207\16w\372\370\304F"
  "\261\320 Ra\4\60\210\24\271\371\70\5\13\7\251`\325 \224\231d\42\212\25\0\60\211\22\267\372\270"
  "\344\224\261\212AB\244\212\205$\33\0\60\212\23\266\373\70E\62\211\214\310E$\221I\205\62\22\0\60"
  "\213\24\251\371\270\14tu\203\220&\22\323e$\231\210j\3\60\214\27\272\371\270$KT\211Hd\220"
  "\11u#\312\210\42\211\224$\7\60\215\21\251\371\270\14tu\203\220&\22\323\265\332\0\60\216\21x\372"
  "\270\304f\211\215&!RdJ\42\0\60\217\27\272\371\270$+\25\223E&\243\212\304\22\62E*\223"
  "\21\345\0\60\220\30\252\371\270\14\222u\3Q\42\23)\222\244$\11IB\21\221M\0\60\221\30\252\371"
  "\270\14v\271\201(\25\211HB\21\231\36\220\220(B\222\0\60\222\26\271\371\70\5S\203U.\244\230"
  "\324\310\22\251H*\71P\0\60\223\24\252\371\70%\203\311`r\226Ie\62\242H\42%\1\60\224\24"
  "\272\352\270d\22!I\42\227\220\254\64\311\302d\260\14\60\233\13Dh\271$\42\211&\0\60\234\12C"
  "XyT(*\0\60\235\13V\33\71\310d\241I\6\60\236\17\207\32y\205\42\241\210N\227\332\204\0"
  "\60\241\15f\372\70\234\224lR\241\20\0\60\242\21\232\370\70<H\206\62\251Hl\227\14\326\1\60\243"
  "\15u\372\70\325d\24\212P\5\0\60\244\15\247\372\270U\25M$\261N\0\60\245\17v\372\270\244\62"
  "\203AH\23\312h\0\60\246\21\271\371\70\5\213\6\7\71\263`.\246R\1\60\247\14G\12y\14D"
  "\261\314`\20\60\250\16z\11y\14\6\252dW\203\203\0\60\251\21w\372\70\305\42\203AF\224\210H"
  "R\22\0\60\252\24\271\372x\5k\6G:Y\42\25\311h\202\71\15\0\60\253\23\270\372\370\344\212\6"
  "\3M\237\204\42\241DJ\244\0\60\254\33\271\372\370D\22\231H\42\223\32\14D\231P&\224)\312\204"
  "\42\251DH\2\60\255\21\271\371\70\5\203\203\304@\30\34\34\10\273\1\60\256\25\272\371\70E\22\241H"
  "\42\64\210\14\224\311\201b\260\354\10\60\257\23\250\372\370\344\6\232\222P\42\224H\305\252D\62\0\60\260"
  "\25\272\372\370%\62\25\231\201*\23\252\11eR\301:\231\20\60\261\23\252\371\270$\223\203\201$\23\252"
  "I%\203u\62\0\60\262\26\253\371\270\244\22\221T\42\62\30\204\62\251PU\64Y\250\3\60\263\14\210"
  "\12\71\34\350\272\33\334\5\60\264\20\252\371\370%r\211\301eO\6\3e\4\60\265\25\252\371\370Te"
  "R\231\310\340 S\225Ie\202u*\0\60\266\27\253\371\270d\22%\231DI&\64\70\312\304\62\261"
  "L\262P\7\60\267\20\251\371x(\323\263H(\230+\23\315\0\60\270\22\252\371x\210\22\231\212\250,"
  "\223\12\266S\355\0\60\271\22\232\371x\14\6\311\302d\60\21\313dT\273\0\60\272\25\252\371\370%\22"
  "\203A\42\227\14&\203\211X&\243\332\5\60\273\24\252\370\370$k\16\42\3QM*\22KF\7\12"
  "\0\60\274\32\253\370\370\204\22\231P\42\223\31\15\42\211A(\225\211Er\321\354@\2\60\275\21\230\372"
  "\70\304\22\251D*\226\213U\211d\0\60\276\22\251\372\270%T\211\252H*\27\314\225\251t\0\60\277"
  "\23\251\371\70\5\7\232P$\65Q\344te*\31\0\60\300\25\253\371\70e\22\241\201\42\23\252\212X"
  "$\225\205:!\0\60\301\21\252\371\270i\6\312\242\301A*Y\230\223\1\60\302\24\253\371\270-\22\3"
  "I\42\25M\15\16b\321\312\240\16\60\303\20w\372\270\204\42\25%\211L,\244\21\1\60\304\24\251\371"
  "\370\244\62\25\221L\42\222I\244\202\271\62\225\14\60\305\25\272\371\370%\62\25\232X$\23\251\211\244\222"
  "\301:\231\16\60\306\20\232\371\270\14\366\270\301A*\31\254\323\1\60\307\23\252\371\370%\42\203E\36\65"
  "\70H%\203u:\0\60\310\17\266\373\70\244Zm\42\212\220\252\25\0\60\311\23\267\373\70\304\62\11M"
  "B\66\212HB\211X\63\0\60\312\21\272\371x%\213\6\7\251da\62\230\323\1\60\313\14j\31\271"
  "\14\366\304\203\203\0\60\314\23\232\371\270\14\6\311`J\222\23&b\231\214j\10\60\315\24\272\371\70%"
  "c\203A\62\230\223-$\222\214(Y\5\60\316\15\210\12\371\225\345bU\42\31\0\60\317\23\212\371\370"
  "Db\231T&\224\312\244\62\261DN\30\60\320\30\253\371\70&\202\211L$\227\211eRE\251P,"
  "\222K\4\23\0\60\321\30\253\371\70\12#\231HB\224\211eRE\251P,\222K\4\23\0\60\322\17"
  "\230\12\71\344\32)\6\232\134\341`\20\60\323\23\231\12\71\244\22\252\204\60\63\31\244\202\225\203A\2\60"
  "\324\24\231\12\71\244\24\241\210J\221\231\14R\301\312\301 \1\60\325\16\231\371\70<\254\13\346\312T\62"
  "\0\60\326\21\271\371\270%b\211\301a]\60W\246\322\1\60\327\22\272\371\370\351\42\203\203`\62\230\14"
  "\326\311\204\0\60\330\15j\31\371\350\42\251P&\26-\60\331\21\212\31\371%r\211\214.\222\12eb"
  "\321\2\60\332\21\212\31\371\351\42\31\211&\222\12eb\321\2\60\333\26\271\371\70\5\213\6G\261DQ"
  "\42\322&\21\311hr\42\0\60\334\34\272\370\70%#\211P$\61\70H\345\22U\211H&\222\211\324"
  "$\62A\25\0\60\335\33\273\370\70E\63\252Hd\60P\250\202\211\262D$\24\311\224d\42\231\244\14"
  "\60\336\16\211\11\71<\314\325Hb\312\22\0\60\337\14\247\372x\354t\301]rg\60\340\24\251\371\70"
  "\5\353\202\211T&T\22\31$\6\241`\0\60\341\22\251\372\370\5k\64\251a.\221\312DT:\0"
  "\60\342\22\212\11y\14\6\251dlp\220I\226\16\24\0\60\343\20x\372\270\344*\6\3I(\221\312"
  "\205\0\60\344\24\253\370\370Dk\6\231A$\261\310\304\42\271l\264\12\60\345\14G\12y\14b%\203"
  "A\0\60\346\16z\11y\14\6\311\302d\315\340 \60\347\15f\372\70\134%\6\252\324`\20\60\350\20"
  "\231\371\70<\254\30\14\204\205\203\203`\0\60\351\22\251\371x\14\6y\320\340\60\27\314\305D+\0\60"
  "\352\15\246\373\70\204|T\25\312h\0\60\353\27\252\371x\305\42\261H,\22\213d\42\65\221n\22\231"
  "\214&\11\60\354\17\247\372\70\304z%Jd\42\11\215\12\60\355\14\210\12\71<\363lp\20\13\60\356"
  "\14f\372\70\34\204Dm\64\0\60\357\16\230\372\70<\63\253\213\245D*\0\60\360\24\272\371\270%k"
  "\6\67U\231T&\63\70\210%k\0\60\361\20\211\11y\14\6\301T\42\246\13\26\15\16\60\362\21\230"
  "\372\70\34\350*\6\203X.\226\322\254\0\60\363\17\231\371\70(S\301\134\60W&\232\1\60\364\27\272"
  "\371\70E\22\241H\42\224\32\134\344\22\271`\62\230\223\311\0\60\365\16v\372\270\244\62\203I\27\31\211"
  "\2\60\366\17w\372\270\304b\203A$\226\12\211\0\60\367\25\253\371\370%j\26\25\223D\243X&\226"
  "IF\223u\0\60\370\33\272\352\70%\312\22E\203\304@\221\312\304\42\261\304 \62HDb\311\42\0"
  "\60\371\27\233\11\371%\222\211\324 \221\30db\221`\64:P\14F\1\60\372\24\253\371\370%j\26"
  "\25\223DYp\65\211&\13u\0\60\373\10\42=\71\14\2\60\374\10\30J\71\34\10\60\375\11F\32"
  "\71\310d\5\60\376\15w\32y\205\42\241\210NW\1\0";

#define F_F1 u8g2_font_f12_kana
#define F_F2 u8g2_font_f16_t_japanese2
#define F_EN u8g2_font_crox3h_tf

void getChar(char* input_char) {
  (printFile.readStringUntil('\n')).toCharArray(input_char, 100);
  delay(200);
}

void setup(void) {
  u8g2.begin();
  // u8g2.setFont(u8g2_font_ncenB14_tr); // choose a suitable font
  Serial.begin(9600);
  while (!Serial) {
    ;
  }
  SD.begin(SDCARD_SS_PIN);
  printFile = SD.open("TEST.TXT", FILE_WRITE);
  printFile.seek(0);

  if (!printFile) {
    Serial.println("The text file cannot be opened");
  }
  Serial.println("Test Message");
  pinMode(2, INPUT);
  u8g2.setFontMode(0);  // enable transparent mode, which is faster
}

void loop(void) {
  getChar(F1);
  getChar(F2);
  getChar(EN);
  Serial.println(F1);
  Serial.println(F2);
  Serial.println(EN);

  u8g2.setFont(F_F1); // set the target font to calculate the pixel width
  F1_width = u8g2.getUTF8Width(F1); // calculate the pixel width of the text
  u8g2.setFont(F_F2); // set the target font to calculate the pixel width
  F2_width = u8g2.getUTF8Width(F2); // calculate the pixel width of the text
  u8g2.setFont(F_EN); // set the target font to calculate the pixel width
  F2_width = u8g2.getUTF8Width(EN); // calculate the pixel width of the text
  F1_offset = 0; // start over again
  F2_offset = 0; // start over again
  EN_offset = 0; // start over again

  do {
    u8g2.firstPage();
    do {
      // draw the scrolling text at current offset
      x = F1_offset;
      do { // repeated drawing of the scrolling text...
        u8g2.setFont(F_F1);
        u8g2.drawUTF8(x, F1_y, F1); // draw the scolling text
        x += F1_width; // add the pixel width of the scrolling text
      } while ( x <= 128 ); // draw again until the complete display is filled
  
      x = F2_offset;
      do {                // repeated drawing of the scrolling text...
        u8g2.setFont(F_F2);
        u8g2.drawUTF8(x, F2_y, F2);      // draw the scolling text
        x += F2_width;           // add the pixel width of the scrolling text
      } while ( x <= 128 );   // draw again until the complete display is filled
  
      x = EN_offset;
      do {                // repeated drawing of the scrolling text...
        u8g2.setFont(F_EN);
        u8g2.drawUTF8(x, EN_y, EN);      // draw the scolling text
        x += EN_width;           // add the pixel width of the scrolling text
      } while ( x <= 128 );   // draw again until the complete display is filled
      // u8g2.setFont(u8g2_font_inb16_mr);  // draw the current pixel width
      // u8g2.setCursor(0, 58);
      // u8g2.print(width); // this value must be lesser than 128 unless U8G2_16BIT is set
  
    } while ( u8g2.nextPage() );
  
    F1_offset -= 2; // scroll by one pixel
    if ( F1_offset < - F1_width ) F1_offset = 0; // start over again
    F2_offset -= 2; // scroll by one pixel
    if ( F2_offset < - F2_width ) F2_offset = 0; // start over again
    EN_offset -= 2; // scroll by one pixel
    if ( EN_offset < - EN_width ) EN_offset = 0; // start over again
  
    delay(10); // do some small delay
  } while (digitalRead(2) == LOW);
}
